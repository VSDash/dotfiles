# mise.toml - Example Configuration for Node.js Projects
# Place this file in your project root to automatically:
# - Switch to the correct Node.js version
# - Set project-specific environment variables
# - Define project tasks for common workflows
#
# Learn more: https://mise.jdx.dev/

# ============================================================================
# Development Tools
# ============================================================================
# Specify exact versions or use version specifiers like 'lts', 'latest', etc.

[tools]
node = "22"           # Latest Node 22.x (or use "lts" for LTS version)
pnpm = "9"            # Specific pnpm version

# Uncomment for multiple versions (useful for testing)
# node = ["20", "22"]  # Install both Node 20 and 22
# python = ["3.11", "3.12"]  # Multiple Python versions

# Additional tools
# bun = "latest"      # Latest Bun version
# terraform = "1.6"   # For IaC projects
# go = "1.21"         # If you have Go modules
# python = "3.12"     # For Python scripts

# Tool-specific options
# [tools.node]
# version = "22"
# # Run after installation
# postinstall = "corepack enable"

# ============================================================================
# Environment Variables
# ============================================================================
# Set project-specific environment variables
# These override shell variables when in this directory

[env]
NODE_ENV = "development"
# API_URL = "http://localhost:3000"
# DATABASE_URL = "postgresql://localhost/mydb"
# LOG_LEVEL = "debug"

# Conditional environment based on profiles
# [env.production]
# NODE_ENV = "production"
# API_URL = "https://api.example.com"

# ============================================================================
# Tasks - Common Development Workflows
# ============================================================================
# Replace or complement package.json scripts with mise tasks
# Run with: mise run <task-name> or mise run (runs default task)

[tasks.dev]
description = "Start development server"
run = "pnpm run dev"

[tasks.build]
description = "Build the project"
run = "pnpm run build"

[tasks.test]
description = "Run all tests"
run = "pnpm test"

[tasks.lint]
description = "Lint and format code"
run = """
pnpm run lint
pnpm run format
"""

[tasks.clean]
description = "Clean build artifacts and dependencies"
run = """
rm -rf dist build .next out
rm -rf node_modules
"""

[tasks.fresh]
description = "Fresh install - clean and reinstall dependencies"
depends = ["clean"]
run = "pnpm install"

[tasks.docker-up]
description = "Start Docker services"
run = "docker-compose up -d"

[tasks.docker-down]
description = "Stop Docker services"
run = "docker-compose down"

[tasks.migrate]
description = "Run database migrations"
run = "pnpm run migrate"

[tasks.setup]
description = "Setup project for first time"
run = """
echo "Installing dependencies..."
pnpm install
echo "Running database setup..."
mise run docker-up
mise run migrate
echo "Setup complete! Run 'mise run dev' to start"
"""

# ============================================================================
# Task Dependencies
# ============================================================================
# Tasks can depend on other tasks

[tasks.ci]
description = "Run CI checks (lint, test, build)"
depends = ["lint", "test", "build"]

# ============================================================================
# Background Tasks & File Watching
# ============================================================================

[tasks.watch]
description = "Watch and rebuild on file changes"
run = "pnpm run build --watch"
# Use mise watch for automatic reruns
# mise watch -t build

[tasks.dev-watch]
description = "Watch mode with multiple watchers"
run = """
# Start multiple watch processes
pnpm run watch:css &
pnpm run watch:js &
pnpm run dev
"""

# ============================================================================
# Advanced: File-based Task Dependencies
# ============================================================================
# Tasks can specify source files they depend on
# mise will only run the task if sources are newer than outputs

[tasks.build-optimized]
description = "Build with smart file watching"
sources = ["src/**/*.ts", "src/**/*.tsx"]
outputs = ["dist/**/*"]
run = "pnpm run build"

[tasks.test-changed]
description = "Test only changed files"
sources = ["src/**/*.test.ts"]
run = "pnpm run test --changed"

# ============================================================================
# Hooks - Run commands on events
# ============================================================================

# [hooks]
# enter = """
# echo "Entering project directory"
# mise install --quiet
# """
# leave = """
# echo "Leaving project directory"
# """

# ============================================================================
# Load additional environment from files
# ============================================================================
# Load .env files automatically

_.file = [".env", ".env.local"]

# Template support for environment-specific files
# _.file = ".env.{{NODE_ENV}}"

# ============================================================================
# Min/Max versions (optional)
# ============================================================================
# Specify minimum mise version required

[min_version]
mise = "2024.1.0"
